```
!pip install facenet-pytorch
```

```
from PIL import Image
from facenet_pytorch import MTCNN, InceptionResnetV1

# 이미지 불러오기
img_path = "/content/drive/MyDrive/Colab Notebooks/Facenet/predata/AnYujin/AnYujin13.jpg"
img = Image.open(img_path)

# MTCNN 및 InceptionResnetV1 모델 인스턴스화
mtcnn = MTCNN(image_size=224, margin=0)
resnet = InceptionResnetV1(pretrained='vggface2').eval()

# 잘라내고 사전 흰화된 이미지 텐서 가져오기
img_cropped = mtcnn(img, save_path="/content/drive/MyDrive/Colab Notebooks/Facenet/mtcnn/output.jpg")

# 임베딩 계산 (배치 차원을 추가하려면 unsqueeze 사용)
img_embedding = resnet(img_cropped.unsqueeze(0))

# VGGFace2 분류를 사용하는 경우
resnet.classify = True
img_probs = resnet(img_cropped.unsqueeze(0))
```
```
import cv2
import matplotlib.pyplot as plt
from facenet_pytorch import MTCNN

# 이미지 불러오기
img_path = "/content/drive/MyDrive/Colab Notebooks/Facenet/predata/AnYujin/AnYujin13.jpg"
img = cv2.imread(img_path)
img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# MTCNN 모델 인스턴스화
mtcnn = MTCNN(image_size=224, margin=0)

# 얼굴 감지
boxes, _ = mtcnn.detect(img)

# 감지된 얼굴 주위에 바운딩 박스 그리기
if boxes is not None:
    for box in boxes:
        # 감지된 얼굴 주위에 사각형 그리기
        cv2.rectangle(img, (int(box[0]), int(box[1])), (int(box[2]), int(box[3])), (255, 0, 0), 2)

# 이미지 출력
plt.imshow(img)
plt.axis('off')
plt.show()
```

![image](https://github.com/YeoungJun0508/Face-recognition/assets/145903037/8f45f19a-e7f3-409b-a306-b41b4251fe37)


```
# 임베딩 및 분류 결과 출력
print("임베딩:")
print(img_embedding)
print("분류 결과:")
print(img_probs)
```
임베딩:
tensor([[ 1.4222e-02, -6.2270e-03, -8.0064e-02,  1.6392e-02,  5.1520e-03,
         -2.3624e-02, -2.7894e-02,  3.4903e-02,  1.1623e-02, -4.2491e-02,
         -7.9762e-03,  2.1237e-03,  4.3400e-02,  1.9166e-02,  3.8946e-02,
         -7.3103e-02, -1.3752e-02,  3.6468e-02,  2.5542e-02, -5.3607e-02,
         -5.4463e-02, -1.9376e-02,  4.4642e-02, -3.6905e-02,  4.6620e-02,
         -4.1202e-02, -5.1624e-02, -5.9789e-02,  8.2392e-03, -2.8636e-02,
          4.0797e-02, -7.2019e-03, -3.8575e-02, -3.2519e-03,  1.3360e-02,
          3.2748e-03,  4.3987e-03, -2.1529e-02, -6.9478e-02,  6.5132e-02,
         -1.4306e-02, -3.1688e-03, -2.8977e-02,  4.2361e-02,  5.6681e-02,
          8.3186e-03, -7.0730e-03, -2.6616e-02, -3.3226e-02, -1.1204e-01,
          5.4056e-03, -2.6658e-02, -2.1162e-02,  9.5132e-03, -9.1133e-02,
          2.1540e-02, -2.9560e-02, -1.1563e-02, -2.4419e-02, -7.2484e-02,
         -1.6619e-02,  2.2754e-02, -7.1436e-02, -3.5188e-02, -6.8509e-03,
          5.5690e-02,  2.2114e-02, -2.9581e-02, -2.1395e-02, -1.3254e-02,
          3.8434e-02, -2.2052e-02, -1.3670e-02, -3.7113e-02,  4.5651e-02,
         -9.9108e-02,  1.4153e-02, -6.4407e-03,  1.2903e-02,  6.6565e-02,
          1.5805e-02,  8.8508e-02, -1.2358e-02,  2.8017e-02, -2.8194e-02,
          9.5896e-02, -1.5690e-02,  8.7860e-02, -2.3456e-02,  4.0616e-02,
          3.1079e-02,  9.9659e-03,  5.4426e-02, -7.0357e-02,  1.9524e-02,
          1.3085e-03, -4.2353e-04,  3.7112e-02, -3.2560e-02,  2.3340e-02,
         -2.4054e-02,  8.1331e-03,  6.7912e-02, -2.0654e-02, -2.8944e-02,
          3.8899e-02, -4.6583e-03, -3.2022e-02, -7.1720e-02, -3.1559e-03,
          2.3844e-02, -9.0115e-03, -2.6982e-02,  2.6277e-02, -7.4409e-03,
         -2.8443e-02,  3.9498e-02,  1.6145e-02, -9.2106e-02,  4.9754e-02,
         -6.7037e-02,  1.1508e-02, -2.8461e-02,  1.1431e-01, -1.9097e-02,
         -3.9226e-02, -3.3772e-02,  2.0822e-02,  3.0647e-02, -2.6429e-02,
          2.2276e-02, -3.2980e-02,  8.2375e-02,  7.4905e-03,  7.6622e-02,
          3.7961e-02,  4.2498e-02, -6.7029e-02,  1.1186e-02,  1.5406e-02,
         -7.5618e-02,  3.0895e-02, -2.5246e-02,  4.3970e-02,  7.5831e-02,
         -1.6482e-02, -7.2545e-02,  2.5336e-02,  9.4106e-02, -2.5060e-02,
         -1.9424e-02, -1.7808e-03, -2.5016e-03,  4.7435e-02,  4.4573e-02,
         -8.1611e-02,  1.0699e-01, -5.1398e-02,  2.4588e-02, -1.5744e-02,
          3.6065e-02,  1.9852e-02,  9.1364e-03, -2.9547e-04,  2.6290e-02,
          2.0154e-02, -6.7257e-02,  1.3783e-02,  1.9647e-02,  2.1040e-02,
         -7.4859e-02,  2.9015e-02, -2.4290e-02,  1.8079e-02, -1.0522e-01,
         -2.6704e-02,  3.8708e-02,  1.1559e-02, -3.6201e-02,  2.2900e-02,
          6.1211e-02, -2.3398e-02, -2.5956e-02,  8.9872e-02,  5.3283e-02,
          6.9096e-02, -2.1290e-02, -1.1128e-02,  6.3188e-02,  4.4402e-02,
         -3.4532e-02, -4.7735e-02,  9.4658e-03,  6.0350e-02, -1.9721e-02,
          2.5112e-02,  4.1250e-02, -2.8489e-02,  4.9897e-02,  4.0430e-02,
          2.8982e-02, -5.9871e-02, -1.7255e-02,  1.6518e-02, -8.1028e-03,
          6.2833e-03,  4.1557e-03,  4.0158e-02,  7.9481e-02,  9.2420e-02,
         -5.1042e-02,  1.8187e-02, -5.5997e-02,  2.5958e-02, -5.1590e-02,
          4.8081e-02, -6.0281e-02, -2.1577e-02, -1.4484e-02, -2.5745e-02,
          1.0745e-02, -9.5983e-04,  2.8195e-03,  3.5320e-02, -2.4203e-02,
          2.5553e-02, -1.9374e-03, -3.6543e-02, -2.1353e-02, -9.3023e-03,
         -5.8676e-02,  1.4036e-02,  6.4339e-02, -8.9087e-03, -1.9041e-02,
          2.8953e-02, -2.3516e-02, -2.1764e-03,  7.5951e-02, -1.7647e-02,
         -1.2754e-02,  7.2235e-03,  1.4566e-03, -3.2199e-02, -5.5278e-02,
         -2.5662e-02, -1.7174e-03,  5.1424e-02, -3.1012e-03,  7.1727e-02,
          5.9849e-02,  4.4245e-02, -1.6116e-02, -6.4179e-02,  4.8385e-02,
          2.0154e-02,  1.1008e-01, -9.2552e-03,  1.0692e-02, -4.9439e-02,
          8.5500e-03,  4.5174e-02, -5.3784e-02, -3.0135e-03,  5.8577e-02,
          5.3747e-02,  1.1854e-03, -8.3958e-03, -4.9317e-02, -5.2088e-03,
         -1.2329e-01, -4.9153e-02, -1.1254e-02, -3.3817e-02,  3.4339e-05,
         -2.6538e-02,  3.4380e-02, -3.8542e-02,  6.9579e-02,  3.9694e-02,
          5.8727e-02,  1.5118e-02, -1.5134e-02,  1.2567e-02,  7.2336e-02,
          1.0632e-02, -3.6339e-02,  3.6508e-02,  4.5133e-02,  3.7715e-02,
          5.8488e-02, -1.9531e-02,  8.2027e-02, -2.4802e-02, -1.9308e-02,
          4.3937e-02,  2.2169e-03,  5.3841e-02,  4.5346e-02,  4.1384e-02,
         -5.9949e-02,  5.1212e-02, -6.5190e-03, -6.2029e-02, -6.0625e-04,
         -4.5953e-02,  6.1896e-02, -6.2007e-02, -1.3630e-02,  1.9926e-03,
         -8.5811e-02,  6.3212e-02,  8.5917e-02, -4.0840e-02,  1.2299e-02,
          5.0870e-03,  1.9738e-02, -4.0800e-03,  2.3358e-02,  5.4896e-02,
          2.7934e-02, -4.9139e-02,  5.8567e-02,  4.0904e-03, -2.4987e-04,
         -7.2748e-02,  1.2787e-02,  1.1551e-02,  3.1703e-02,  6.3044e-02,
         -2.5073e-02,  7.4235e-02, -1.0694e-02,  4.8587e-02, -2.2850e-02,
         -1.7432e-02, -7.2111e-02,  2.4589e-02,  8.1637e-02, -3.4045e-02,
          1.2869e-02, -5.1409e-03, -2.4481e-02,  3.4674e-02, -4.4537e-02,
          4.5772e-02,  8.9635e-03, -1.4537e-02,  3.4926e-03,  5.0637e-02,
          3.1316e-02, -8.9566e-03,  3.2896e-02, -2.6492e-02,  8.2711e-02,
         -1.5194e-02, -4.0516e-02,  1.1291e-02,  2.5897e-02, -6.8060e-02,
          2.1649e-02, -7.1305e-03, -4.5340e-02,  1.0184e-04,  4.3319e-02,
         -5.1395e-02,  7.9825e-02,  1.1586e-02, -1.9663e-02, -4.6025e-02,
          7.6964e-03, -9.6665e-02,  5.0280e-02,  1.1435e-02, -1.2519e-02,
          1.7383e-02,  6.3168e-04,  6.3227e-02, -3.7586e-02, -4.0819e-02,
          5.6998e-03, -4.3788e-02, -1.4413e-02,  2.8678e-02, -9.8313e-02,
         -1.0316e-02, -8.1023e-02, -4.9865e-02,  8.4618e-02, -1.0739e-02,
         -4.1500e-02, -3.0253e-02,  2.9648e-02,  3.6139e-02,  9.1464e-03,
          3.1398e-02,  1.4479e-02,  4.0166e-02, -6.0141e-02,  1.2069e-02,
         -4.2670e-02,  7.5582e-03, -4.7104e-02,  5.4329e-03,  4.3633e-02,
          6.2465e-02, -3.7562e-03, -1.5877e-02, -1.6854e-02, -6.0724e-02,
         -1.4336e-02,  1.6254e-02,  1.8464e-02, -3.3197e-02,  4.8015e-02,
          9.2117e-02,  5.6186e-02,  6.8321e-03, -4.8715e-02,  1.1987e-02,
         -2.3990e-02,  3.4226e-02, -3.4133e-02,  7.1846e-02, -3.7200e-02,
          2.9814e-02, -2.1806e-02, -3.2386e-02,  1.9137e-02, -3.7489e-02,
         -5.0103e-02,  2.1096e-02,  1.1177e-02, -2.1748e-03, -4.6336e-02,
         -3.0912e-03,  1.9729e-02, -5.6914e-03, -5.4305e-02,  4.4630e-02,
          6.3533e-02,  1.4370e-02, -5.8371e-03,  9.5389e-02,  6.1186e-02,
          1.8874e-02, -1.6681e-02, -9.9503e-02,  3.7071e-02,  9.7855e-03,
         -2.5149e-02,  9.1610e-02, -4.4859e-02, -3.1377e-02, -1.1435e-02,
          2.4791e-02, -2.7260e-02,  8.6499e-02,  7.2900e-02, -4.2746e-02,
          6.7310e-03, -6.5768e-04, -7.7181e-03, -4.2268e-02, -3.2926e-02,
         -1.5947e-02, -1.0711e-01,  4.4980e-02,  5.9286e-02,  9.5299e-02,
          2.2446e-02,  1.0113e-01, -2.5508e-02, -2.8676e-02,  5.8465e-02,
         -9.0549e-02, -6.1710e-02, -8.5766e-02,  7.3967e-02,  8.8056e-02,
         -9.3936e-02, -2.4561e-02, -1.2355e-02,  3.9431e-02,  3.0739e-02,
         -3.5352e-02, -6.3446e-03,  7.0550e-03,  8.2732e-02, -7.1672e-02,
          2.2800e-02, -6.5348e-02, -2.6200e-02, -5.3958e-04, -2.4549e-02,
         -5.5281e-02,  5.5720e-02,  1.7653e-02,  1.9353e-02,  3.7441e-02,
         -4.6808e-03, -3.7576e-02, -5.6691e-02,  3.0416e-02, -8.6248e-02,
          1.0001e-01,  2.6762e-02, -2.3905e-02, -2.8005e-02, -7.4082e-02,
          1.5045e-02,  1.0333e-02]], grad_fn=<DivBackward0>)
분류 결과:
tensor([[ 3.4837, -0.4746, -1.1916,  ...,  4.7395,  5.4022,  4.3523]],
       grad_fn=<AddmmBackward0>)

임베딩값과 pretrained 모델인 vggface2의 클래스 중 유사한 1순위이다.
(facenet은 트리플넷을 손실함수로 사용하여 유사클래스의 순위를 매길 수 있다.)


